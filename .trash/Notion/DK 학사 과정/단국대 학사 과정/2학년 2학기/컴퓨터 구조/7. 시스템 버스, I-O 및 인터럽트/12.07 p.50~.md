# 7.4 인터럽트를 이용한 IO
- 인터럽트를 발생할 수 있는 IO 장치들이 여러 개가 존재하는 시스템에서 그러한 문제들을 해결하는 방법
    - 다중 인터럽트 방식
    - 데이지 체인 방식
    - 소프트웨어 폴링 방식
## 7.4.1 다중 인터럽트 방식
![[Source/Untitled 136.png|Untitled 136.png]]
- 각 IO와 제어기와 CPU 사이에 별도의 INTR, INTA 선을 접속
    - 제어기가 INTR 신호 세트
    - CPU가 INTA 신호 세트(인터럽트 요구를 인식했다는 표시) 및 인터럽트를 위한 서비스 시작
    - 제어기가 INTR 리셋
    - CPU도 INTA 리셋
- IO 장치들에 대한 우선순위를 정해놓고 동시에 인터럽트가 들어왔을 때 우선순위에 따라 CPU가 서비스를 제공하도록 한다.
- 인터럽트 플래그를 사용하면 서비스 제공 중 다른 INTR 신호를 받지 않게 할 수 있다.
- 인터럽트 플래그를 사용하지 않으면 우선순위가 더 높은 INTR 신호가 들어오면 현재 서비스 중단하고 새로운 인터럽트에 대하여 응답한다.
- 장점
    - IO 장치가 별도의 인터럽트 선을 가지고 있어서 CPU가 인터럽트를 요구한 장치를 쉽게 찾아낼 수 있다.
- 단점
    - IO 장치에 대하여 두 개씩의 신호 선들이 필요하므로 하드웨어가 복잡해진다.
    - 접속 가능한 IO 장치들의 수가 그 신호들을 위해 할당되는 CPU 칩의 핀 수에 의해 제한된다.
  
## 7.4.2 데이지 체인 방식
![[Source/Untitled 1 90.png|Untitled 1 90.png]]
- INTA 출력 선을 IO 제어기들에 직렬로 접속하는 방식
- 마스터들에는 Ain, Aout이 있다.
- 인터럽트를 요구한 IO 장치는 Ain 입력을 받는 즉시 인터럽트 벡터를 데이터 버스(자신의 고유 ID)를 통하여 CPU로 전송
    - 인터럽트 벡터는 해당 IO 장치를 위한 인터럽트 서비스 루틴의 시작 주소를 결정하는데 사용
- 만약 Ain 입력을 받은 IO 장치가 인터럽트를 요구하지 않은 상태라면, 그 입력을 다음 장치로 통과 시킨다.
- 장점
    - 하드웨어가 간단
- 단점
    - 우선순위가 낮은 장치들이 서비스를 받지 못하고 매우 오랫동안 기다려야 하는 경우가 발생
  
## 7.4.3 소프트웨어 폴링 방식
![[Source/Untitled 2 62.png|Untitled 2 62.png]]
- CPU가 모든 IO 제어기들에 접속된 Test IO 선을 이용하여 인터럽트를 요구한 장치를 검사하는 방식
    - TEST IO 신호를 이용하여 각 IO장치의 인터럽트 플래그가 세트
- 장점
    - 우선순위 변경이 용이
- 단점
    - 처리 시간이 오래 걸림
# 7.5 직접기억장치액세스
- Direct Memory Access(DMA)
    
    ![[Source/Untitled 3 50.png|Untitled 3 50.png]]
    
    - CPU의 개입 없이 IO장치와 기억장치 사이에 데이터를 전송하는 방식
    - 사이클 스틸링이라고도 한다.
    - 방법
        - CPU가 주기억장치에 액세스하지 않는 시간동안에 이뤄진다.
        - 시스템 버스를 사용하여 주기억장치와 IO 장치 간에 데이터 전송
  
- DMA 처리 순서
    
    1. CPU가 DMA 제어기로 다음 정보를 포함한 명령을 전송
        1. IO 장치의 주소 (예: 디스크 드라이브 번호, 실린더 번호, 섹터 번호)
        2. 연산 지정자 (연산은 쓰기 혹은 읽기)
        3. 데이터가 쓰여지거나 읽혀질 주기억장치 영역의 시작 주소
        4. 전송될 데이터 단어들의 수
    2. DMA 제어기는 CPU로 버스 요구(BUS REQ) 신호를 전송
    3. CPU가 DMA 제어기로 버스 승인(BUS GRANT) 신호를 전송
    4. DMA 제어기가 주기억장치로부터 데이터를 읽어옴, 이후 디스크 제어기로 전송
        1. 주기억장치 → DMA 제어기
        2. DMA 제어기 → 디스크 제어기 → 데이터 저장
        3. 각 데이터에 대하여 2,3,4번 동작을 2번 반복하는 것이다.(1회에 a 수행, 2회에 b 수행)
    5. 저장할 데이터들이 남아있다면, 그 수만큼 2~4번 동작을 반복
    6. 모든 데이터들의 저장이 완료되면, CPU로 INTR 신호를 전송
    
      
    
- DMA 문제점
    - 각 데이터 전송 떄마다 시스템 버스를 두 번씩 사용
        - 버스 사용량 증가로 인한 시스템 성늘 저하
        - 해결책
            - IO 장치들을 DMA 제어기에 접속 → DMA 제어기가 주 기억장치를 액세스 할 때만 시스템 버스 사용
    - IO 장치들은 종류, 속도가 다양해서 DMA 제어기가 복잡해진다.
    - 해결책
        
        - IO 프로세서(IOP) 사용(IO 채널이라고도 부름)
        
          
        
- IOP 보드에 포함될 요소들
    - IO 제어 프로그램을 수행할 수 있는 프로세서
    - 데이터 블록을 임시 저장(버퍼링) 할 수 있는 용량의 지역 기억장치
    - 시스템 버스 인터페이스 및 버스 마스터 회로
    - IO 버스 중재 회로