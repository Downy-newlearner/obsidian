- 리뷰
    - p44
    - 성능을 테스트할 수 있는 여러 도구가 있다.
        - 베이직 도구
            - gettimeofday
        - 중간
        - 고급
    - combine()을 gettimeoday로 성능 측정
  
## strace
- 어떤 시스템 콜을 사용했는지 확인할 수 있다.
- 코드는 쉘
    - shell → fork() → cat을 exec
- strace -f ./mysh
- -f : 트레이씽 중에 포크를 한 것을 발견하면 child까지 따라가서 트레이씽 한다.
  
- fork: 실제로는 clone() 실행
    - 새로운 pid에 attach되어서 그 프로세스를 따라 트레이싱한다.
- 프로그래머가 많이 이용
## top
- 현재 시스템의 상태
- 어떤 프로세스가 존제하고, 프로세스의 부하가 얼마나 큰지 확인
- 시스템 관리에 사용하는 명령어이다.
- 시스템 관리자가 많이 이용
## Perf event
- CPU 내부의 정보
- 소프트웨어의 정보
    - 페이지 폴트, 컨텍스트 스위치 정보
- 하드웨어 정보
- 트레이스 포인트 정보
    - 브레이크 포인트 같은 것이 트레이스
        - 브레이크 포인트와 다르게 멈추진 않고, 지나가면서 위치의 정보를 수집
        - 어떤 함수가 얼마나 빈번히 사용됐는지를 수집할 수 있다.
- 위 정보들을 모두 모아서 Perf event 라고 한다.
- 성능 분석가가 많이 이용
  
## Copy on Write ( COW)
- 포크해서 자식 프로세스 만들 때 얼마나 복사가 된다…? 이 때 나옴
- COW는 페이징 시스템에서 사용됨
- 세그맨테이션은 주소 변환이 아니라 논리적으로만 사용된다.
- 페이징 사용 시스템은 중간에 세그멘테이션을 무시하고 어떤 시스템(?)은 페이지로 구성된다.
- 가상 주소는 페이지로 → 페이지 테이블 → 물리적 메모리는 페이지 프레임으로
- 세그멘테이션은 소프트웨어 선에서 관리됨 페이지를 모아서 여기까지 세그멘테이션..
- 여기까지 읽어만 보기
- 포크가 발생하면 부모와 똑같은 이미지의 새로운 자식이 만들어진다.
    - 텍스트 부분은 공유 , 데이터, 스택은 복사를 해서 따로 갖고있다고 배웠다.
        - 프로세스는 서로 독립적이어야하므로
        - Read Only는 공유해도 되지만 Write가 가능한 부분은 따로 갖는게 맞다.
    - 그런데 카피하는 것이 비용이 많이 든다. 부모의 데이터 스택을 복사하는 것은 자원이 많이 든다.
    - 또한 복사를 해도 사용하지 않고 대부분 버려지는게 문제다.
    - 포크하고 바로 이그젝을 하면 카피한 것이 소용없어진다.
    - 해결책
        - write하기 전까진 공유하다가 write를 하려고 하면 그때 복사를 하자
            
            - 이것이 COW
            
              
            
- 공유하면서 COW 비트를 켜놓음
    - write하면 카피 해야한다는 걸 의미
- child가 write하면 그제서야 카피를 하고 프로세스는 독립적이게 된다.
- COW는 컴퓨터에서 많이 사용하고있는 최적화 중 하나인 Lazy evaluation이다
    
    - Lazy evaluation: 버틸 수 있을만큼 버티고 버티면 안될 때에 작업을 수행
        - 예: write가 발생하면 메모리에 쓰고 버티다가 모아서 디스크에 작성
        - write가 발생하면 또 발생한다는 기대가 있기 떄문이다.
    
      
    
      
    
## 암달의 법칙
- 암달은 유명 개발자
- 프로그램 성능 개선 후 얼마나 스피드업 되었냐의 모델링
- Told → Tnew
- 알파 : 전체의 몇 퍼센트를 개선했느냐
- 많이 사용되는 부분을 개선하는 것이 유리하다. (ppt의 implication 참고)
  
## 성능 개선 기술
- 적절한 알고리즘, 자료구조 사용
- 성능 최적화를 위한 기본적인 principles 준수
    - 함수호출 줄이기
    - 불필요한 메모리 줄이기
- 로우 레벨 최적화를 하자.
    - 하드웨어 특성을 활용한 최적화
- 암달의 법칙 염두에 두기