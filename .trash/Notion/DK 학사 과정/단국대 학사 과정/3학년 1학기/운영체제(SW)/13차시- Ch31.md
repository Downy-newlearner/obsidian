조건변수는 동기화, 즉 순서관계를 맞추는데에 집중한다.
생산자 소비자 문제(버퍼에 아이템 한 개까지 들어간다.)
empty, fill이라는 조건변수를 사용해 버퍼의 상태를 확인한다.
  
---
## Ch. 31 Semaphores
---
Semaphores
동시성 제어를 위해 사용되는 구조이다.
1. 락(상호 배제를 위함) 또는 조건 변수(동기화를 위함)를 위해 사용될 수 있다.
2. 이진 세마포(mutex), 카운팅 세마포 존재.
    
    자원이 하나여도, 자원이 여러개여도 사용할 수 있다.
    
      
    
**메서드**
**sem_init**
매개변수
1. 세마포 객체
2. 0이면 하나의 프로세스 내의 스레드에서 공유, 0이 아니면 프로세스 간 공유
3. 세마포 객체 초기화 값
**sem_wait(P연산, 시도 연산, 자원 요청)**
세마포 값 감소
값이 0보다 크거나 같으면 감소 / 값이 0이라면 값이 증가할 때까지
**sem_post(V연산, 증가 연산, 자원 반환)**
sem_signal이라고 불린다.
세마포 값을 증가시키고 대기하고있는 스레드가 있다면 하나를 깨워준다.
  
---
p.17
세마포를 락으로 사용하기
1. 세마포 선언
2. 세마포 초기화 할 때 3번째 매개변수를 1으로 준다.
  
세마포 값은 음수가 될 수도, -1보다 작아질 수도 있다.(스레드가 여러개이면 된다.)
세마포가 1이면 임계 영역에 들어올 수 있다는 뜻
0이면 스레드가 임계영역에 들어있다는 뜻
음수이면 wait 중인 스레드가 있다는 뜻
---
p.19
세마포를 조건 변수로 사용하기
1. 세마포 선언
2. 세마포 초기화 할 때 3번째 매개변수를 0으로 준다.
  
**조건 변수를 사용하는 방식과 세마포를 사용하는 방식은 무슨 차이가 있을까?**
세마포는 카운트 변수를 사용하지 않는다.
조건변수를 사용할 때는 큐만 바뀌지만, 세마포는 정수값을 가지고있는 객체로 카운트 값을 갖고있다.
그래서 세마포가 코딩하기 더 쉽다.
  
조건 변수는 락을 잡고 웨이트, 시그널을 한다.
뮤텍스 → 오더링
세마포는 세마포를(empty, fill)을 먼저 체크하고 뮤텍스를 잡는다.
오더링 → 뮤텍스
---
p.21
기록자, 판독자 문제
다른점
생산자 소비자는 공유 자원에 대해서 둘 다 상태를 바꾼다.(버퍼를 채우거나 / 비우거나)
→항상 상호배제를 보장해야한다.
기록자는 공유 자원의 상태를 바꾸지만, 판독자는 상태를 바꾸지 않고 읽기만 한다.
→판독자만 있을 때는 상호배제를 고려하지 않아도 된다.
그렇다면 상호 배제를 고려하지 않는 판독자가 기록자 뒤에 대기한다면 판독자를 우선 수행시켜야하나?
yes: 기아상태 발생
no: 병렬성 저하
---
p.23
식사하는 철학자 문제
5명 철학자, 5개의 포크(서로의 가운데에 포크가 놓여있고 둘이서 하나의 포크를 공유한다.)
  
포크들에 대해 세마포를 하나씩 할당.(초기에 세마포를 1로 초기화한다.)
  
---
p.25
만약 모든 철학자들이 오른쪽 포크를 집으면 데드락이 걸린다.(아무도 wait에서 빠져나오지 못한다.)
해결1. 철학자 수를 4명으로 줄이면 데드락이 발생하지 않는다.
해결2. 마지막 철학자가 포크를 잡는 순서를 거꾸로 한다.
해결3. 오른쪽, 왼쪽 포크를 동시에 잡도록 한다.(트랜젝션, all or nothing 보장)