<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <title>환경공간정보서비스 - 토지피복지도 예제</title>
    <style type="text/css">
        html, body, #map { margin: 0; padding: 0; width: 100%; height: 100%; }
    </style>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.11.1/ol.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.11.1/ol.min.js"></script>
</head>
<body>
<div id="map"></div>    
<script type="text/javascript">
    // 지도 초기화
    var map = new ol.Map({
        target: 'map',
        layers: [new ol.layer.Tile({
            source: new ol.source.TileWMS({
                url: 'https://egisapp.me.go.kr/geoserver/gwc/service/wms?',
                params: {
                    'LAYERS': 'EGIS:lv3_2023y',
                    'TILED': true,
                    'SRS': 'EPSG:3857'
                }
            })
        })],
        view: new ol.View({
            center: ol.proj.transform([127, 36.5], 'EPSG:4326', 'EPSG:3857'),
            zoom: 7,
            enableRotation: false
        })
    });

    // CSV 파일 로드 및 핀 추가
    fetch('./data/도로공사 로드킬 (2019-2022).csv')
        .then(response => response.text())
        .then(csv => {
            const lines = csv.split('\n');
            const features = [];

            for (let i = 1; i < lines.length; i++) { // 헤더를 건너뜀
                const line = lines[i];
                const cells = line.split(',');

                if (cells.length < 9) continue; // 잘못된 데이터 건너뛰기

                const latitude = parseFloat(cells[7]);
                const longitude = parseFloat(cells[8]);

                if (isNaN(latitude) || isNaN(longitude)) continue;

                const feature = new ol.Feature({
                    geometry: new ol.geom.Point(ol.proj.fromLonLat([longitude, latitude]))
                });
                features.push(feature);
            }

            const vectorSource = new ol.source.Vector({
                features: features
            });

            const vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 5,
                        fill: new ol.style.Fill({ color: 'red' }),
                        stroke: new ol.style.Stroke({ color: 'black', width: 1 })
                    })
                })
            });

            map.addLayer(vectorLayer);
        })
        .catch(error => console.error('Error loading the CSV file:', error));
</script>
</body>
</html>
