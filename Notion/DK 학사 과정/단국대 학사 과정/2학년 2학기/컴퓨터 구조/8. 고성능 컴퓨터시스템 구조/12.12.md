## 8.3.3 시스템 구성 방법에 따른 분류
- 일반 병렬 컴퓨터
    - 거의 모든 컴퓨터는 여러개의 코어를 가지고있음 → 기본적으로 병렬 컴퓨터라는 것
        - 거의 다 공유 메모리를 가지고있다.
        - 로컬 메모리 대신 로컬 캐시가 있는 것이다.(CPU 코어안에 L1, L2 존재)
- 분산 시스템
    - 인터넷에 분산되어있는 많은 데이터를 처리
- 클러스터 컴퓨터
    - 분산 시스템과 유사
    - 사용자가 사용하는 네트워크가 아닌 특별한 커넥션을 새로 만들어 컴퓨터의 클러스링을 많들어서 고속 네트워크를 사용한다.
  
## 8.4.1
- 공유 기억장치에서 가장 중요한 것은 프로세서를 얼마나 효율적으로 연결하느냐이다.
- 계산된 데이터를 공유해야하므로 이를 ⚠️
- 초기에는 공유버스 사용
    - 버스를 사용함은 충돌 발생이 필연적
    - MIN(다단계 상호연결망)으로 이를 해결 지금도 MIN을 사용 중이다.
- 이런 게 있다 정도만 알면 된다.
- 자세히 알 필요는 없다.
  
- 현재 슈퍼컴퓨터들은 MIN 구조가 아니라 하이퍼큐브 네트워크를 사용한다
    - 이는 매우 복잡하니 이런게 있다 정도만 알고있기(8.4.2도 읽어만 보기)
  
## 8.4.3 캐시 일관성 유지 프로토콜 중요!
- 공유 메모리를 가진 컴퓨터를 사용할 떄 중요한 것은 캐시 일관성 유지이다.
- 캐시 일관성 유지를 위한 프로토콜
- 캐시 쓰기 정책
    - write-through 정책
        - 주 기억장치에서 데이터를 캐시로 가져오고 캐시에 수정이 발생하면 즉시 주 메모리의 데이터도 같이 수정해준다. (즉, 바로 업데이트)
        - 이 때 수정을 위해 공유 버스를 사용했음을 다른 프로세서들도 알 수 있다.
            - 버스 감시(bus snooping)을 이용
                - 프로세서가 어떤 캐시라인을 수정하는 경우에 그 사실을 방송
                - 스누프 제어기(snoop controller)가 수행한다.
            - 버스 감시를 통해서 다른 캐시에서도 공유하고있던 데이터가 수정됐다면 즉시 수정한다.
    - write-back 정책
        - 캐시에서 업데이트가 되어도 즉시 메모리에 수정을 하지 않는다.
        - 프로세서1에서 메모리의 x라는 데이터를 읽어와서 x’으로 수정했다고하자
        - 프로세서2가 x를 읽어오고 싶다면 메모리의 x가 아닌 캐시의 x’을 읽어와야한다.
        - 버스 감시를 이용해서 수행
  
- write-through 일관성 유지 프로토콜
    - 주기억장치에 대한 쓰기 동작의 주소가 자신의 캐시에 있는지 검사한다.
    - 만약 존재한다면 그 블록을 무효화시킨다.
        - 프로세서가 무효화된 블록을 액세스하는 경우에는 캐시 미스로 처리
        - 캐시 데이터의 상태는 유효 상태 | 무효 상태 가 있다.
            - 유효상태 : 캐시 내용 = 주기억장치의 내용
            - 무효상태 : 캐시 내용 ≠ 주기억장치의 내용’
- write-back 일관성 유지와 MESI 프로토콜
    - 변경된 캐시의 스누피 제어기가 변경 사실을 다른 스누피 제어기들에게 통보한다.
        - 무효화 신호
            - 데이터의 변경 사실을 알려주기 위한 신호
        - 무효화 사이클
            - 무효화 신호가 전송되는 버스 사이클
    - MESI 프로토콜에서 캐시 데이터의 상태
        - M odified
            - 자기 캐시 안의 데이터를 수정했을 때 세팅
        - E xclusive
            - 유일한 복사본이고, 주기억장치의 내용과 동일한 상태일 때 세팅
        - S hared
            - 데이터가 두 개 이상의 프로세서 캐시에 적재되어있는 상태
        - I nvalid
            - 데이터가 다른 프로세서에 의해 수정되어 무효가 된 상태
  
==프로세서 각각이 할당받는 캐시가 존재하나?==
L1? L2 같은 진짜 캐시? 아니면 그냥 레지스터?
답변 : 프로세서는 코어 안 쓰레드들이 담당한다. 이용하는 캐시는 L1, L2 같은 캐시들이다.
  
8.5 GPU도 구경만 하기